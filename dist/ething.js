!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.EThing=t():e.EThing=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t,n){var r=n(17)||{};function o(e,t,n){var r;if(Array.isArray(t))for(var i in t){var a=t[i];/\[\]$/.test(e)?n(e,a):o(e+"["+("object"==typeof a?i:"")+"]",a,n)}else if("object"==typeof t)for(r in t)o(e+"["+r+"]",t[r],n);else n(e,t)}r.isId=function(e){return"string"==typeof e&&7===e.length&&/^[0-9a-zA-Z\-_]+$/.test(e)},r.parseUrl=function(e){var t=/^((([a-z]+):)?\/\/)?(([^:]*)(:([^@]*))?@)?([^:\/?#]+)?(:([0-9]+))?([^?#]+)?(\?[^#]*)?(#.*)?$/i.exec(e);return!!t&&{scheme:t[3],user:t[5],password:t[7],hostname:t[8],port:t[10],path:t[11],search:t[12],hash:t[13]}},r.getParam=function(e,t){var n=e.indexOf("?"),r=new RegExp("[\\?&]"+encodeURIComponent(t)+"=([^&#]*)"),o=-1!==n?r.exec(e.substr(n)):null;return null===o?"":decodeURIComponent(o[1])},r.getQueryString=function(e,t){var n=e.indexOf("?"),r=new RegExp("[\\?&]"+encodeURIComponent(t)+"=([^&#]*)"),o=-1!==n?r.exec(e.substr(n)):null;return null===o?"":decodeURIComponent(o[1])},r.removeParam=function(e,t){var n=e.split("?");if(n.length>=2){var r=n[1].indexOf("#"),o="";-1!==r&&(o=n[1].substr(r),n[1]=n[1].substr(0,r));for(var i=encodeURIComponent(t)+"=",a=n[1].split(/[&;]/g),s=a.length;s-- >0;)-1!==a[s].lastIndexOf(i,0)&&a.splice(s,1);return e=n[0]+(a.length>0?"?"+a.join("&"):"")+o}return e},r.insertParam=function(e,t,n){var o=(e=r.removeParam(e,t)).indexOf("#"),i="";-1!==o&&(i=e.substr(o),e=e.substr(0,o));var a=e.indexOf("?"),s="";return-1!==a&&(s=e.substr(a),e=e.substr(0,a)),s+=s.length?"&":"?",e+(s+=encodeURIComponent(t)+"="+encodeURIComponent(n))+i},r.param=function(e){var t,n=[],r=function(e,t){t="function"==typeof t?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};for(t in e)null!==e[t]&&void 0!==e[t]&&o(t,e[t],r);return n.join("&").replace(/%20/g,"+")};var i=r.pad=function(e,t,n){return n=n||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(n)+e};r.sizeToString=function(e){if(e=parseInt(e),isNaN(e))return"-";return e>9e8?e=Math.floor(e/1e9*100)/100+" GB":e>9e5?e=Math.floor(e/1e6*100)/100+" MB":e>900?e=Math.floor(e/1e3*100)/100+" KB":e+=" B",e},r.dateToString=function(e){var t=new Date;if("number"==typeof e&&(e=new Date(1e3*e)),e){if(t.getTime()-e.getTime()<864e5)return i(e.getHours(),2)+":"+i(e.getMinutes(),2);var n=e.getFullYear(),r=e.getDate(),o=e.getMonth();return n==t.getFullYear()?r+" "+new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")[o]+".":n+"/"+i(o+1,2)+"/"+i(r,2)}return"-"},r.dateDiffToString=function(e){if(e=parseInt(e),isNaN(e))return"-";var t,n=604800,r=86400,o=3600,i=60,a=0,s="";return(t=Math.floor(e/n))>=1&&a<2&&(s+=Math.floor(t)+" week"+(t>1?"s":""),e-=t*n,a++),(t=Math.floor(e/r))>=1&&a<2&&(a&&(s+=" "),s+=Math.floor(t)+" day"+(t>1?"s":""),e-=t*r,a++),(t=Math.floor(e/o))>=1&&a<2&&(a&&(s+=" "),s+=Math.floor(t)+" hour"+(t>1?"s":""),e-=t*o,a++),(t=Math.floor(e/i))>=1&&a<2&&(a&&(s+=" "),s+=Math.floor(t)+" minute"+(t>1?"s":""),e-=t*i,a++),(t=e)>=1&&a<2&&(a&&(s+=" "),s+=Math.floor(t)+" seconde"+(t>1?"s":""),a++),s};var a={};r.createCache=function(e){return function(t,n){return(!a[t]||"function"==typeof a[t].state&&"rejected"===a[t].state())&&(a[t]=e(t)),a[t].done(n)}};var s={},u=s.toString,c=s.hasOwnProperty;"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(e){s["[object "+e+"]"]=e.toLowerCase()}),r.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?s[u.call(e)]||"object":typeof e},r.isPlainObject=function(e){var t;if("object"!==r.type(e)||e.nodeType||null!=e&&e===e.window)return!1;try{if(e.constructor&&!c.call(e,"constructor")&&!c.call(e.constructor.prototype||{},"isPrototypeOf"))return!1}catch(e){return!1}for(t in e);return void 0===t||c.call(e,t)},r.extend=function(){var e,t,n,o,i,a,s=arguments[0]||{},u=1,c=arguments.length,f=!1;for("boolean"==typeof s&&(f=s,s=arguments[1]||{},u=2),"object"!=typeof s&&"function"!=typeof s&&(s={}),c===u&&(s=this,--u);u<c;u++)if(null!=(e=arguments[u]))for(t in e)n=s[t],s!==(o=e[t])&&(f&&o&&(r.isPlainObject(o)||(i=Array.isArray(o)))?(i?(i=!1,a=n&&Array.isArray(n)?n:[]):a=n&&r.isPlainObject(n)?n:{},s[t]=r.extend(f,a,o)):void 0!==o&&(s[t]=o));return s},r.isEqual=function(e,t){"use strict";if(null===e||void 0===e||null===t||void 0===t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;var n=Object.keys(e);return Object.keys(t).every(function(e){return-1!==n.indexOf(e)})&&n.every(function(n){return r.isEqual(e[n],t[n])})},r.inherits=function(e,t){e.prototype=new t,e.prototype.constructor=e},e.exports=r},function(e,t,n){var r=n(0),o=n(3),i=n(16),a=n(7),s=n(5),u=n(6),c={},f=r.extend,l=r.isPlainObject,p=r.XMLHttpRequest;c.Event=a,c.Error=i,c.utils=r,c.utils.Deferred=o,c.DeferredObject=u,c.config={serverUrl:"http://localhost:8000"};var d=[],h=[],y=[],v=[],g=null;s(c),c.toApiUrl=function(e,t){return/^([a-z]+:)?\/\//.test(e=e||"")||(!/^\//.test(e)&&e&&(e="/"+e),e=b()+e),t&&m(e)&&(e=_(e),"function"==typeof g&&(e=g(e))),e};var m=function(e){return new RegExp("^([a-z]+:)?//"+b().replace(/^([a-z]+:)?\/\//,"")).test(e)},b=function(){return c.config.serverUrl.replace(/\/+$/,"")+"/api"};c.apiUrl=function(){return c.toApiUrl()};var j=function(e){var t=new o,n=new p;if("string"==typeof e&&(e={url:e}),"string"!=typeof(e=f({method:"GET",context:null,url:null,data:null,contentType:null,headers:null,dataType:null,converter:null,synchronous:!1},e)).url)return null;var s=c.toApiUrl(e.url),u=m(s);e.method=e.method.toUpperCase();var b=e.context||c,j=!/^(?:GET|HEAD)$/.test(e.method),T=void 0,w=void 0!==e.data&&null!==e.data;!j&&w&&(s+=(/\?/.test(s)?"&":"?")+("string"==typeof e.data?e.data:r.param(e.data))),n.open(e.method,s,!e.synchronous);var x=null;if(l(e.headers))for(var A in e.headers)e.headers.hasOwnProperty(A)&&(/^content-type$/i.test(A)&&(x=e.headers[A]),n.setRequestHeader(A,e.headers[A]));!x&&e.contentType&&n.setRequestHeader("Content-Type",x=e.contentType),j&&w&&(x?(T=e.data,(l(e.data)||Array.isArray(e.data))&&(/json/i.test(x)?T=JSON.stringify(e.data):/application\/x-www-form-urlencoded/i.test(x)&&(T=r.param(e.data)))):e.data instanceof Blob?(n.setRequestHeader("Content-Type",x=e.data.type),T=e.data):e.data instanceof ArrayBuffer||e.data instanceof r.Buffer?(n.setRequestHeader("Content-Type",x="application/octet-stream"),T=e.data):(n.setRequestHeader("Content-Type",x="application/x-www-form-urlencoded; charset=UTF-8"),T="string"==typeof e.data?e.data:r.param(e.data))),u&&(n=_(n),"function"==typeof g&&(n=g(n)));var R=e.dataType;function F(a){var s=n.getResponseHeader("Content-Type")||"",u=null;if(void 0!==a)u=a;else if(/json/.test(s)||/text\/plain/.test(s))switch(n.responseType){case"":case"text":case"json":u=n.response;break;case"blob":if(e.synchronous){if(!r.FileReaderSync)throw new i("FileReaderSync not supported.");var f=new r.FileReaderSync;u=String.fromCharCode.apply(null,new Uint8Array(f.readAsArrayBuffer(n.response)))}else{if(u=o(),!r.FileReader)throw new i("FileReaderSync not supported.");(f=new r.FileReader).onload=function(){u.resolve(String.fromCharCode.apply(null,new Uint8Array(this.result)))},f.readAsArrayBuffer(n.response)}break;case"arraybuffer":u=String.fromCharCode.apply(null,new Uint8Array(n.response));break;case"buffer":u=n.response.toString("utf8");break;default:throw new i(n.responseType+" response type not supported.")}o.when(u).always(function(r){try{r=JSON.parse(r)}catch(e){}var o=[new i(r||(n.status?n.status+" ["+n.statusText+"]":"unknown error")),n,e];c.trigger("ething.request.error",o),y.forEach(function(e){e.apply(b,o)}),c.trigger("ething.request.complete",o),h.forEach(function(e){e.apply(b,o)}),t.rejectWith(b,o)})}R&&"auto"!=R&&(n.responseType=R),n.onload=function(){if(n.status>=200&&n.status<300||304===n.status){var r=n.response;if("auto"==R){if(/json/.test(n.getResponseHeader("Content-Type")||""))try{r=JSON.parse(r)}catch(e){}}else if("json"==R&&"string"==typeof r)try{r=JSON.parse(r)}catch(e){}"function"==typeof e.converter&&(r=e.converter.call(b,r,n,e)),function(r){var o=[r,n,e];c.trigger("ething.request.success",o),d.forEach(function(e){e.apply(b,o)}),c.trigger("ething.request.complete",o),h.forEach(function(e){e.apply(b,o)}),t.resolveWith(b,o)}(r)}else F()},n.onerror=function(e){F(e)},n.onabort=function(){F()},n.onprogress=function(r){t.notifyWith(b,[r,n,e])};var O=a("ething.request.send");return c.trigger(O,[n,e]),O.isDefaultPrevented()?F("Aborded"):(v.forEach(function(e){e.call(b,n)}),n.send(T)),t.promise()};var T=c.getClass=function(e){var t=e.split(/[.\\]/);if(t.length>0&&void 0!==c[t[0]])return c[t[0]]};c.instanciate=function(e){var t=T(e.type);return t||e.extends.indexOf("Device")>=0&&(t=T("Device")),!!t&&new t(e)};c.resourceConverter=function(e){if("object"==typeof e&&null!==e){var t=Array.isArray(e);t||(e=[e]),e=e.map(function(e){return c.instanciate(e)}).filter(function(e){return e}),c.arbo&&(e=c.arbo.update(e).resources),t||(e=e.length?e[0]:null)}return e},c.request=function(e,t){var n=j(e);if("function"==typeof t&&n.always(function(){t.apply(this,Array.prototype.slice.call(arguments))}),e.synchronous){var r=null;return n.always(function(e){r=e}),r}return n},c.apiRequestPrefilter=function(e){g=e},c.ajaxSend=function(e){"function"==typeof e&&v.push(e)},c.ajaxComplete=function(e){"function"==typeof e&&h.push(e)},c.ajaxSuccess=function(e){"function"==typeof e&&d.push(e)},c.ajaxError=function(e){"function"==typeof e&&y.push(e)},c.list=c.find=function(e,t){var n=null,o=null;return 1==arguments.length?"function"==typeof arguments[0]?o=arguments[0]:n=arguments[0]:arguments.length>=2&&(n=arguments[0],o=arguments[1]),c.request({url:"/resources?"+r.param({q:n}),method:"GET",dataType:"json",converter:c.resourceConverter},o)},c.get=function(e,t){var n;if(e instanceof c.Resource)n=e,e=e.id();else if(!r.isId(e))throw"First argument must be a Resource object or a Resource id : "+e;var o=t;return c.request({url:"/resources/"+e,dataType:"json",method:"GET",context:n,converter:c.resourceConverter},o)},c.usage=function(e){var t=e;return c.request({url:"/usage",dataType:"json",method:"GET"},t)};var w=function(e){return e},x=null,A=null,R=null,_=w;c.auth={},c.auth.isAuthenticated=function(){return!!R},c.auth.getApp=function(){return x instanceof c.App?x:null},c.auth.getDevice=function(){return x instanceof c.Device?x:null},c.auth.getResource=function(){return x},c.auth.getScope=function(){return A},c.auth.reset=function(){x=null,R=null,A=null,_=w},c.auth.setApiKey=function(e){c.auth.reset(),_=function(t){return"string"==typeof t?t=c.utils.insertParam(t,"api_key",e):t.setRequestHeader("X-API-KEY",e),t}},c.auth.setBasicAuth=function(e,t){c.auth.reset(),_=function(n){return"string"==typeof n?n=n.replace(/\/\/([^:]+:[^@]+@)?/,"//"+e+":"+t+"@"):n.setRequestHeader("Authorization","Basic "+r.btoa(e+":"+t)),n}},c.initialize=function(e,t,n){return c.auth.reset(),(e=f({serverUrl:null,apiKey:null,login:"ething",password:null},e||{})).serverUrl&&(c.config.serverUrl=e.serverUrl),e.apiKey?c.auth.setApiKey(e.apiKey):e.login&&e.password&&c.auth.setBasicAuth(e.login,e.password),c.request({url:"/auth",dataType:"json",context:c,converter:function(e){R=e.type,e.resource&&(x=c.instanciate(e.resource)),e.scope&&(A=e.scope)}}).done(function(){F.forEach(function(e){e.call(c)}),c.trigger("ething.authenticated")}).done(t).fail(n)};var F=[];c.authenticated=function(e){"function"==typeof e&&(F.push(e),c.auth.isAuthenticated()&&e.call(c))},e.exports=c},function(e,n,r){var o=r(0),i=r(5),a=r(6),s=r(1),u=function(e){a.call(this),i(this),this._fromJson(e,!0)};o.inherits(u,a),u.prototype._fromJson=function(e,t){var n=this._json&&e&&this._json.modifiedDate&&e.modifiedDate&&this._json.modifiedDate!==e.modifiedDate,r=[];return e=o.extend({name:null,id:null,type:null,createdBy:null,createdDate:0,modifiedDate:0,data:null,description:null},e||{}),!t&&n&&Object.keys(e).forEach(function(t){void 0!==this._json[t]&&o.isEqual(e[t],this._json[t])||r.push(t)},this),this._json=e,!t&&n&&(this.trigger("updated",[r]),s.trigger("ething.resource.updated",[this,r])),n},u.prototype.json=function(){return this._json},u.prototype.isTypeof=function(e){return-1!==this._json.extends.indexOf(e)},u.prototype.name=function(){return this._json.name},u.prototype.dirname=function(){return s.Resource.dirname(this._json.name)},u.prototype.basename=function(){return s.Resource.basename(this._json.name)},u.prototype.extension=function(){return s.Resource.extension(this._json.name)},u.prototype.id=function(){return this._json.id},u.prototype.createdBy=function(){return this._json.createdBy},u.prototype.type=function(){return this._json.type},u.prototype.types=function(){return this._json.extends||[]},u.prototype.baseType=function(){return t=this.types(),t[t.length-1]},u.prototype.createdDate=function(){return new Date(this._json.createdDate)},u.prototype.ctime=function(){return this.createdDate()},u.prototype.modifiedDate=function(){return new Date(this._json.modifiedDate)},u.prototype.mtime=function(){return this.modifiedDate()},u.prototype.public=function(){return this._json.public||!1},u.prototype.data=function(e,t){return void 0===e?this._json.data:this._json.data.hasOwnProperty(e)?this._json.data[e]:t},u.prototype.attr=function(e){return void 0===e?this._json:this._json.hasOwnProperty(e)?this._json[e]:null},u.prototype.hasAttr=function(e){return this._json.hasOwnProperty(e)},u.prototype.description=function(){return this._json.description||""},u.prototype.remove=function(e,t){return this.deferred(function(){return u.remove(this,t)})},u.prototype.update=function(e){return this.deferred(function(){return s.get(this,e)})},u.prototype.set=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),u.set.apply(s,n)})},u.prototype.setData=function(e,t){if("string"==typeof e&&"function"!=typeof t){var n=e,r=t;t=arguments[2];(e={})[n]=r}return this.set({data:e},t)},u.remove=function(e,t,n){var r;if(e instanceof u)r=e,e=e.id();else if(!o.isId(e))throw"First argument must be a Resource object or a Resource id : "+e;return 2==arguments.length&&"function"==typeof t&&(n=t,t=!1),s.request({url:"/resources/"+e+"?"+o.param({children:t}),method:"DELETE",context:r},n).done(function(){s.trigger("ething.resource.removed",[e])})},u.set=function(e,t,n){var r;if(!o.isPlainObject(t)||!t)throw"Second argument must be a unempty object !";if(e instanceof u)r=e,e=e.id();else if(!o.isId(e))throw"First argument must be a Resource object or a Resource id : "+e;var i=n;return s.request({url:"/resources/"+e,dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:t,context:r,headers:{"X-HTTP-Method-Override":"PATCH"},converter:s.resourceConverter},i)},u.dirname=function(e){var t=e.replace(/\/[^\/]*\/?$/,"");return t===e?"":t},u.basename=function(e){return e.replace(/.*\//,"")},u.extension=function(e){return e.indexOf(".")>=0?e.split(".").pop():""},u.fnmatch=function(e,t){for(var n,r,o=e.split(" "),i=0;i<o.length;i++)if(""!=o[i]&&(n="^"+(n="^"+o[i].replace(/\//g,"\\/").replace(/\*\*/g,"(\\/[^\\/]+)*").replace(/\*/g,"[^\\/]+").replace(/((?!\\))\?/g,"$1.")+"$")+"$",r=new RegExp(n),null!=t.match(r)))return!0;return!1},s.Resource=u,e.exports=u},function(e,t){function n(e){var t="pending",r=[],o=[],i=[],a=null,s=[["resolve","done"],["reject","fail"],["notify","progress"]],u={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(Array.isArray(arguments[e]))for(var n=arguments[e],o=0;o<n.length;o++)"resolved"===t&&n[o].apply(this,a),r.push(n[o]);else"resolved"===t&&arguments[e].apply(this,a),r.push(arguments[e]);return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(Array.isArray(arguments[e]))for(var n=arguments[e],r=0;r<n.length;r++)"rejected"===t&&n[r].apply(this,a),o.push(n[r]);else"rejected"===t&&arguments[e].apply(this,a),o.push(arguments[e]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(Array.isArray(arguments[e]))for(var n=arguments[e],r=0;r<n.length;r++)"pending"===t&&i.push(n[r]);else"pending"===t&&i.push(arguments[e]);return this},then:function(){var e=arguments;return n(function(t){s.forEach(function(n,r){var o="function"==typeof e[r]&&e[r];c[n[1]](function(){var e=o&&o.apply(this,arguments);e&&"function"==typeof e.promise?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[n[0]+"With"](this===u?t.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){if(null==e)return u;for(var t in u)e[t]=u[t];return e},state:function(){return t},debug:function(){console.log("[debug]",r,o,t)},isRejected:function(){return"rejected"===t},isResolved:function(){return"resolved"===t}},c={resolveWith:function(e){if("pending"===t){t="resolved";for(var n=a=arguments.length>1?arguments[1]:[],o=0;o<r.length;o++)r[o].apply(e,n)}return this},rejectWith:function(e){if("pending"===t){t="rejected";for(var n=a=arguments.length>1?arguments[1]:[],r=0;r<o.length;r++)o[r].apply(e,n)}return this},notifyWith:function(e){if("pending"===t)for(var n=a=arguments.length>1?arguments[1]:[],r=0;r<i.length;r++)i[r].apply(e,n);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},f=u.promise(c);return e&&e.apply(f,[f]),f}n.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:void 0;return e&&"function"==typeof e.isResolved&&"function"==typeof e.isRejected?e.promise():n().resolve(e).promise()}return function(e){for(var t=n(),r=e.length,o=0,i=new Array(r),a=0;a<e.length;a++)!function(n){var a=null;e[n].done?e[n].done(function(){i[n]=arguments.length<2?arguments[0]:arguments,++o==r&&t.resolve.apply(t,i)}).fail(function(){t.reject(arguments)}):(a=e[n],e[n]=new Deferred,e[n].done(function(){i[n]=arguments.length<2?arguments[0]:arguments,++o==r&&t.resolve.apply(t,i)}).fail(function(){t.reject(arguments)}).resolve(a))}(a);return t.promise()}(arguments)},e.exports=n},function(e,t,n){var r=n(1),o=n(0),i=n(2),a=function(e){i.call(this,e),(this._json.methods||[]).forEach(function(e){if(void 0===this[e]){var t=this;this[e]=function(t,n,o){var i=[].slice.call(arguments);return this.deferred(function(){return i.unshift(e),i.unshift(this),a.execute.apply(r,i)})},this[e].getApi=function(n){return a.getApi(t,e,n)},this[e].executeUrl=function(n){return t.executeUrl(e,n)}}},this)};o.inherits(a,i),a.prototype.location=function(){return this._json.location||null},a.prototype.connected=function(){return!!this._json.connected},a.prototype.lastSeenDate=function(){return"string"==typeof this._json.lastSeenDate?new Date(this._json.lastSeenDate):null},a.prototype.hasBattery=function(){return"number"==typeof this._json.battery&&this._json.battery>=0},a.prototype.battery=function(){return this.hasBattery()?this._json.battery:null},a.prototype.methods=function(){return this._json.methods||[]},a.prototype.interfaces=function(){return this._json.interfaces||[]},a.prototype.execute=function(){var e=[].slice.call(arguments);return this.deferred(function(){return e.unshift(this),a.execute.apply(r,e)})},a.prototype.executeUrl=function(e,t){var n="devices/"+this.id()+"/call/"+e;return isPlainObject(t)&&0!==Object.keys(t).length&&(n+="?"+o.param(t)),r.toApiUrl(n,!0)},a.prototype.getApi=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),a.getApi.apply(r,n)})},a.execute=function(e,t,n,i,s){var u;if(e instanceof a)u=e,e=e.id();else{if(!o.isId(e))throw"First argument must be a Device object or a Device id !";e=e}return 4==arguments.length?"function"==typeof i&&(s=i,i=void 0):3==arguments.length&&"function"==typeof n&&(s=n,n=void 0),r.request({url:"/devices/"+e+"/call/"+t,method:"POST",contentType:"application/json; charset=utf-8",data:void 0!==n&&null!==n?JSON.stringify(n):void 0,dataType:i?o.isNode?"buffer":"blob":"auto",context:u},s)},a.getApi=function(e,t,n){var i;if("function"==typeof t&&void 0===n&&(n=t,t=void 0),e instanceof a)i=e,e=e.id();else{if(!o.isId(e))throw"First argument must be a Device object or a Device id !";e=e}return r.request({url:"/devices/"+e+"/api"+(t?"/"+t:""),method:"GET",context:i,dataType:"json"},n)},a.create=function(e,t,n){return t.type=e,r.request({url:"/devices",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:t,converter:r.resourceConverter},n).done(function(e){r.trigger("ething.device.created",[e])})},r.Device=a,e.exports=a},function(e,t,n){var r=n(7);e.exports=function(e){var t={};e.on=function(e,n){if("function"==typeof n){e=e.split(" ");for(var r=0;r<e.length;r++){var o=e[r];o.length&&(t[o]||(t[o]=[]),t[o].push(n))}}},e.off=function(e,n){e=e.split(" ");for(var r=0;r<e.length;r++){var o=e[r];if(o.length&&t[o])if("function"==typeof n)for(var i=0;i<t[o].length;i++)t[o][i]===n&&(t[o].splice(i,1),i--);else t[o]=[]}},e.one=function(t,n){"function"==typeof n&&e.on(t,function(){e.off(t,n),n.apply(this,Array.prototype.slice.call(arguments))})},e.trigger=function(n,o){"string"==typeof n&&(n=r(n));for(var i=n.type,a=t[i]||[],s=0;s<a.length;s++){var u=[n];if(Array.isArray(o)&&(u=u.concat(o)),a[s].apply(e,u),n.isImmediatePropagationStopped()||n.isPropagationStopped())break}return n}}},function(e,t,n){var r=n(3);e.exports=function(){var e=r().resolve(),t=[],n=this;function o(){for(var e=0;e<t.length;e++){var r=t[e].dfr,o=t[e].pending,i=t[e].fn;if(o)t[e].pending=!1,i.call(n,n).done(function(){var e=Array.prototype.slice.call(arguments);r.resolveWith(n,e)}).fail(function(){r.rejectWith(n,Array.prototype.slice.call(arguments))}).progress(function(){r.notifyWith(n,Array.prototype.slice.call(arguments))});else if(r.isResolved()||r.isRejected()){t.splice(e,1),e--;continue}break}}["done","fail","always","progress","then","state","isRejected","isResolved"].forEach(function(r){this[r]=function(){var o=(t.length?t[t.length-1].dfr:e)[r].apply(n,Array.prototype.slice.call(arguments));return"object"==typeof o&&"then"!==r?n:o}},this),this.promise=function(){return n},this.deferred=function(e){var n=new r;return n.always(function(){o()}),t.push({fn:e,dfr:n,pending:!0}),o(),this}}},function(e,t,n){var r=n(0);function o(){return!0}function i(){return!1}var a=function(e,t){if(!(this instanceof a))return new a(e,t);this.type=e,t&&r.extend(this,t),this.timeStamp=Date.now()};a.prototype={constructor:a,isDefaultPrevented:i,isPropagationStopped:i,isImmediatePropagationStopped:i,preventDefault:function(){this.isDefaultPrevented=o},stopPropagation:function(){this.isPropagationStopped=o},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=o,this.stopPropagation()}},e.exports=a},function(e,t,n){var r=n(1),o=n(0),i=(n(2),n(3)),a=(n(5),[]),s=null,u=null;function c(e,t,n){Array.isArray(e)||(e=[e]);var o=[],i=[],s=[];if(t&&(a.forEach(function(t,n){if(!(t instanceof r.Folder)){for(var i in e)if(e[i].id()===t.id())return;o.push(n)}}),o.map(function(e){var t=a[e];return a.splice(e,1),t})),e.forEach(function(t,n){var r=!1;for(var o in a)if(a[o].id()===t.id()){r=o;break}if(!1===r)i.push(t),f(t);else{var u=a[r];u._fromJson(t.json())&&s.push(u),e[n]=u}}),t)for(var u=0;u<a.length;u++){var c=a[u];c instanceof r.Folder&&0==c.find(function(e){return!(e instanceof r.Folder)}).length&&(o.push(c),a.splice(u,1),u--)}var l=o.length>0||i.length>0||s.length>0;return!n&&l&&r.trigger("ething.arbo.changed",[i,o,s]),{resources:e,removed:o,added:i,updated:s,hasChanged:l}}function f(e){a.push(e);for(var t=e.dirname(),n=!1,o=0;o<a.length;o++)if(a[o]instanceof r.Folder&&a[o].name()===t){n=!0;break}return n||f(new r.Folder({name:t})),e}function l(e,t,n){if(Array.isArray(e))e.forEach(function(e){l(e,t)});else if(("string"!=typeof e||(e=p(e)))&&!0!==e.isRoot){var o=[];e instanceof r.Folder&&e.children().forEach(function(e){l(e,!0)});for(var i=0;i<a.length;i++){var s=a[i];if(s.id()==e.id()){if(o.push(s),a.splice(i,1),!t){var u=s.parent();u&&0==u.children().length&&l(u)}break}}!n&&o.length&&r.trigger("ething.arbo.changed",[[],o,[]])}}function p(e){for(var t=0;t<a.length;t++)if(a[t].id()===e)return a[t]}function d(e,t){return a.filter(function(n){if(!t||n.type()===t){var r=n.name();return"function"==typeof e?!!e.call(n,n):"string"==typeof e?r===e:Array.isArray(e)?e.indexOf(r)>=0:!(e instanceof RegExp)||e.test(r)}})}function h(){return a}r.Folder=function(e){e.id||(e.id="/"+e.name),""===e.name&&(this.isRoot=!0),r.Resource.call(this,o.extend({type:"Folder"},e))},o.inherits(r.Folder,r.Resource),r.Folder.prototype.createdDate=function(){for(var e=this.find(),t=null,n=0;n<e.length;n++)(null===t||t>e[n].createdDate())&&(t=e[n].createdDate());return t},r.Folder.prototype.modifiedDate=function(){for(var e=this.find(),t=null,n=0;n<e.length;n++)(null===t||t<e[n].modifiedDate())&&(t=e[n].modifiedDate());return t},r.Folder.prototype.remove=function(e){var t=this;return this.deferred(function(){var n=[];return this.children().forEach(function(e){n.push(e.remove())}),i.when.apply(i,n).done(function(){"function"==typeof e&&e.call(t)})})},r.Folder.prototype.set=null,r.Folder.prototype.setData=null,r.Folder.prototype.location,r.Folder.prototype.description,r.Folder.prototype.data,r.Folder.prototype.createdBy,r.Folder.prototype.extension=function(){return""},r.Folder.prototype.children=function(e,t){var n=this._json.name.length?this._json.name+"/":"",r=d(new RegExp("^"+n+"[^/]+$"));return void 0!==e&&e&&(r=r.filter(function(r){if(!t||r.type()===t){var o=r.name().substr(n.length);if("function"==typeof e)return!!e.call(r,r,o);if("string"==typeof e)return o===e;if(Array.isArray(e))return e.indexOf(o)>=0;if(e instanceof RegExp)return e.test(o)}})),r},r.Folder.prototype.ls=r.Folder.prototype.children,r.Folder.prototype.find=function(e,t){var n=this._json.name.length?this._json.name+"/":"",r=d(n.length?new RegExp("^"+n):new RegExp("^.+"));return void 0!==e&&e&&(r=r.filter(function(r){if(!t||r.type()===t){var o=r.name().substr(n.length);if("function"==typeof e)return!!e.call(r,r,o);if("string"==typeof e)return o===e;if(Array.isArray(e))return e.indexOf(o)>=0;if(e instanceof RegExp)return e.test(o)}})),r},r.Folder.prototype.findOne=function(e,t){var n=this.find(e,t);return n.length?n[0]:null},r.Folder.prototype.length=function(){return this.children().length},r.Resource.prototype.parent=function(){if(!this.isRoot)return p("/"+this.dirname())},r.on("ething.resource.removed",function(e,t){var n=p(t);n&&l(n)}),r.arbo={load:function(e,t){var n;if(s&&!t)n=!0===s?(new i).resolve().promise():s;else{var o=new i;a=[],s=null,u=null,r.request({url:"/resources",method:"GET",dataType:"json"}).done(function(e){s=!0,a=[],u=new r.Folder({name:""}),a.push(u),e.forEach(function(e){(e=r.instanciate(e))&&f(e)}),o.resolve()}),s=n=o.promise()}return n.done(function(){"function"==typeof e&&e(h()),r.trigger("ething.arbo.loaded")})},lastRefreshTs:0,refresh:function(){return this.lastRefreshTs=Date.now(),function(e){return r.request({url:"/resources",method:"GET",dataType:"json"}).then(function(e){return c(e=e.map(function(e){return r.instanciate(e)}).filter(function(e){return e}),!0),a}).done(e)}.apply(this,Array.prototype.slice.call(arguments))},remove:l,update:c,findOneById:p,list:h,find:d,findOne:function(e,t){var n=d(e,t);return n.length?n[0]:null},isLoaded:function(){return!0===s||s&&"resolved"==s.state()},root:function(){return u}},e.exports=r.arbo},function(e,t,n){var r=n(1),o=n(0),i=n(4);i.MQTT={},i.MQTT.getSubscription=function(e,t){var n;if(e instanceof i)n=e,e=e.id();else if(!o.isId(e))throw"First argument must be a Device object or a Device id !";return r.request({url:"/devices/"+e+"/subscription",dataType:"json",context:n,converter:function(e){return n instanceof i&&(n.subscription=e),e}},t)},e.exports=i.MQTT},function(e,t,n){var r=n(1),o=n(0),i=n(4);i.Http={},i.Http.getSpecification=function(e,t){var n;if(e instanceof i)n=e,e=e.id();else if(!o.isId(e))throw"First argument must be a Device object or a Device id !";return r.request({url:"/devices/"+e+"/specification",dataType:"json",context:n,converter:function(e){return n instanceof i&&(n.swaggerSpecification=e),e}},t)},e.exports=i.Http},function(e,t,n){var r=n(1),o=n(0),i=n(2),a=n(3),s=function(e){i.call(this,e)};o.inherits(s,i),s.prototype.size=function(){return this._json.size||0},s.prototype.iconLink=function(e){return this._json.hasIcon?r.toApiUrl("apps/"+this.id()+"/icon",e):null},s.prototype.getContentUrl=function(e){return r.toApiUrl("apps/"+this.id(),e)},s.prototype.contentModifiedDate=function(){return new Date(this._json.contentModifiedDate)},s.prototype.scope=function(){return"string"==typeof this._json.scope?this._json.scope:""},s.prototype.version=function(){return this._json.version||null},s.prototype.read=function(e){var t=[].slice.call(arguments);return this.deferred(function(){return t.unshift(this),s.read.apply(r,t)})},s.prototype.write=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),s.write.apply(r,n)})},s.create=function(e,t){if(e.content&&(e.content=o.btoa(e.content)),e.icon){if(e.icon instanceof o.Blob){if(!o.FileReader)throw"no FileReader instance found";var n=new o.FileReader,i=a();return n.onloadend=function(){e.icon=n.result.substr(n.result.indexOf(";base64,")+8),r.request({url:"/apps",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:r.resourceConverter}).done(function(){i.resolveWith(this,Array.prototype.slice.call(arguments))}).fail(function(){i.rejectWith(this,Array.prototype.slice.call(arguments))})},n.readAsDataURL(e.icon),i.done(t).done(function(){r.trigger("ething.app.created",[this])}).promise()}if(e.icon instanceof ArrayBuffer){for(var s="",u=new Uint8Array(e.icon),c=0;c<u.byteLength;c++)s+=String.fromCharCode(u[c]);e.icon=o.btoa(s)}else if("string"!=e.icon)throw"invalid type for the icon attribute"}return r.request({url:"/apps",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:r.resourceConverter},t).done(function(e){r.trigger("ething.app.created",[e])})},s.read=function(e,t){var n,i=null;if(e instanceof s)n=e,i=e.id();else{if(!o.isId(e))throw"First argument must be a File object or a file id !";i=e}var a=t;return r.request({url:"/apps/"+i,method:"GET",dataType:"text",context:n},a)},s.write=function(e,t,n){var i,a=null;if(e instanceof s)i=e,a=e.id();else{if(!o.isId(e))throw"First argument must be a File object or a file id !";a=e}if("string"!=typeof t)throw"Second argument must be a string !";var u=n;return r.request({url:"/apps/"+a,dataType:"json",method:"PUT",contentType:"string"==typeof t?"text/plain":"application/octet-stream",data:t,context:i,converter:r.resourceConverter},u)},s.getIcon=function(e,t){var n,i=null;if(e instanceof s)n=e,i=e.id();else{if(!o.isId(e))throw"First argument must be a File object or a file id !";i=e}var a=t;return r.request({url:"/apps/"+i+"/icon",method:"GET",dataType:o.isNode?"buffer":"blob",context:n},a)},r.App=s,e.exports=s},function(e,t,n){var r=n(1),o=n(0),i=n(2),a=function(e){i.call(this,e)};o.inherits(a,i),a.prototype.length=function(){return this._json.length},a.prototype.maxLength=function(){return this._json.maxLength},a.prototype.expireAfter=function(){return this._json.expireAfter},a.prototype.keys=function(){var e=[];for(var t in this._json.keys)this._json.keys.hasOwnProperty(t)&&e.push(t);return e},a.prototype.contentModifiedDate=function(){return new Date(this._json.contentModifiedDate)},a.prototype.select=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),a.select.apply(r,n)})},a.prototype.computeStatistics=function(e,t,n){var o=[].slice.call(arguments);return this.deferred(function(){return o.unshift(this),a.computeStatistics.apply(r,o)})},a.prototype.removeRow=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),a.removeRow.apply(r,n)})},a.prototype.replaceRow=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),a.replaceRow.apply(r,n)})},a.prototype.findOneAndReplace=function(e,t,n,o){var i=[].slice.call(arguments);return this.deferred(function(){return i.unshift(this),a.findOneAndReplace.apply(r,i)})},a.prototype.insert=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),a.insert.apply(this,n)})},a.prototype.import=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),a.import.apply(this,n)})},a.prototype.getContentUrl=function(e){return r.toApiUrl("tables/"+this.id(),e)},a.create=function(e,t){return"string"==typeof e&&(e={name:e}),r.request({url:"/tables",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:r.resourceConverter},t).done(function(e){r.trigger("ething.table.created",[e])})},a.select=function(e,t,n){var i,s=null;if(e instanceof a)i=e,s=e.id();else{if(!o.isId(e))throw"First argument must be a Table object or a table id !";s=e}return void 0===n&&"function"==typeof t&&(n=t,t=null),t=t||{},Array.isArray(t.fields)&&(t.fields=t.fields.join(",")),r.request({url:"/tables/"+s+"?"+o.param({start:t.start,length:t.length,sort:t.sort,q:t.query,fields:t.fields,datefmt:t.datefmt}),method:"GET",dataType:"json",context:i},n)},a.computeStatistics=function(e,t,n,i){var s,u=null;if(e instanceof a)s=e,u=e.id();else{if(!o.isId(e))throw"First argument must be a Table object or a table id !";u=e}return void 0===i&&"function"==typeof n&&(i=n,n=null),r.request({url:"/tables/"+u+"/statistics?"+o.param({key:t,q:n}),method:"GET",dataType:"json",context:s},i)},a.removeRow=function(e,t,n){var i,s=null;if(e instanceof a)i=e,s=e.id();else{if(!o.isId(e))throw"First argument must be a Table object or a table id !";s=e}var u=Array.isArray(t)?t:[t],c=n;return r.request({url:"/tables/"+s+"/remove",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:u,context:i,converter:r.resourceConverter},c)},a.replaceRow=function(e,t,n){var i,s=null;if(e instanceof a)i=e,s=e.id();else{if(!o.isId(e))throw"First argument must be a Table object or a table id !";s=e}if("object"==typeof t&&!o.isId(t.id))throw"Second argument must be an object containing at least a document id";var u=t.id,c=n;return r.request({url:"/tables/"+s+"/id/"+u,dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:t,context:i,headers:{"X-HTTP-Method-Override":"PATCH"}},c)},a.findOneAndReplace=function(e,t,n,i,s){var u,c=null,f=s,l=!1;if(e instanceof a)u=e,c=e.id();else{if(!o.isId(e))throw"First argument must be a Table object or a table id !";c=e}if("string"!=typeof t)throw"Second argument must be a query string";if("object"!=typeof n)throw"Third argument must be an object";return void 0===s&&"function"==typeof i&&(f=i,l=!1),"boolean"==typeof i&&(l=i),r.request({url:"/tables/"+c+"/replace?"+o.param({q:t,upsert:l}),dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:n,context:u,converter:r.resourceConverter},f)},a.insert=function(e,t,n,i){var s,u,c,f=null;if(e instanceof a)u=e,f=e.id();else{if(!o.isId(e))throw"First argument must be a Table object or a table id !";f=e}return"string"==typeof n?(c=n,s=i):s=n,r.request({url:"/tables/"+f+"?"+o.param({invalid_field:c}),dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:t,context:u,converter:r.resourceConverter},s)},a.import=function(e,t){var n,i,s,u;if(e instanceof a)n=e,e=e.id();else if(!o.isId(e))throw"First argument must be a Table object or a table id !";if(!Array.isArray(t))throw"The data must be an array of objects";for(var c=2;c<arguments.length;c++)switch(typeof arguments[c]){case"function":u=arguments[c];break;case"boolean":s=arguments[c];break;case"string":i=arguments[c]}return r.request({url:"/tables/"+e+"?"+o.param({skip_error:s,invalid_field:i}),dataType:"json",method:"PUT",contentType:"application/json; charset=utf-8",data:t,context:n,converter:r.resourceConverter},u)},r.Table=a,e.exports=a},function(e,t,n){var r=n(1),o=n(0),i=n(2),a=function(e){i.call(this,e)};o.inherits(a,i),a.prototype.size=function(){return this._json.size},a.prototype.expireAfter=function(){return this._json.expireAfter||null},a.prototype.mime=function(){return this._json.mime},a.prototype.contentModifiedDate=function(){return new Date(this._json.contentModifiedDate)},a.prototype.thumbnailLink=function(e){return this._json.hasThumbnail?r.toApiUrl("files/"+this.id()+"/thumbnail",e):null},a.prototype.getContentUrl=function(e){return r.toApiUrl("files/"+this.id(),e)},a.prototype.isText=function(){return this._json.isText},a.prototype.isScript=function(){return this._json.isText&&"application/javascript"===this._json.mime},a.prototype.execute=function(e,t){e=[].slice.call(arguments);return this.deferred(function(){return e.unshift(this),a.execute.apply(r,e)})},a.prototype.read=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),a.read.apply(r,n)})},a.prototype.write=function(e,t){var n=[].slice.call(arguments);return this.deferred(function(){return n.unshift(this),a.write.apply(r,n)})},a.create=function(e,t){return"string"==typeof e&&(e={name:e}),r.request({url:"/files",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,converter:r.resourceConverter},t).done(function(e){r.trigger("ething.file.created",[e])})},a.read=function(e,t,n){var i;if(e instanceof a)i=e,e=e.id();else if(!o.isId(e))throw"First argument must be a File object or a file id !";return void 0===n&&"function"==typeof t&&(n=t,t=!1),r.request({url:"/files/"+e,method:"GET",dataType:t?o.isNode?"buffer":"blob":"text",context:i},n)},a.execute=function(e,t,n){var i;if(e instanceof a)i=e,e=e.id();else if(!o.isId(e))throw"First argument must be a File object or a file id !";return void 0===n&&"function"==typeof t&&(n=t,t=null),r.request({url:"/files/"+e+"/execute?"+o.param({args:t}),method:"GET",dataType:"json",context:i},n)},a.write=function(e,t,n){var i,s=null;if(e instanceof a)i=e,s=e.id();else{if(!o.isId(e))throw"First argument must be a File object or a file id !";s=e}var u=n;return r.request({url:"/files/"+s,dataType:"json",method:"PUT",contentType:"string"==typeof t?"text/plain":"application/octet-stream",data:t,context:i,converter:r.resourceConverter},u)},r.File=a,e.exports=a},function(e,t,n){var r=n(1),o=function(e,t,n){var o={};if(3==arguments.length)o.body=t,o.subject=e;else if(2==arguments.length)"string"==typeof t?(o.subject=e,o.body=t):(o.body=e,n=t);else{if(1!=arguments.length)throw"Bad arguments!";o.body=e}return r.request({url:"/notification",method:"POST",contentType:"application/json; charset=utf-8",data:o},n)};r.notify=o,e.exports=o},function(e,t,n){var r=n(1),o=n(0),i={get:function(e){return r.request({url:"/settings",dataType:"json",method:"GET"},e)},set:function(e,t){if(!o.isPlainObject(e))throw"First argument must be an object !";return r.request({url:"/settings",dataType:"json",method:"POST",contentType:"application/json; charset=utf-8",data:e,headers:{"X-HTTP-Method-Override":"PATCH"}},t)}};r.settings=i,e.exports=i},function(e,t,n){var r=n(0);e.exports=function(e){this.constructor.prototype.__proto__=Error.prototype,Error.captureStackTrace(this,this.constructor),this.name="EThing.Error","string"==typeof e&&(e={message:e}),e instanceof Error&&(e={message:e.message}),r.extend(this,{message:"unknown error"},e)}},function(e,t){e.exports={isNode:!1,btoa:window.btoa,atob:window.atob,XMLHttpRequest:window.XMLHttpRequest,Blob:window.Blob,Buffer:function(){},FileReader:window.FileReader||null,FileReaderSync:window.FileReaderSync||null}},function(e,t,n){var r=n(1);n(2),n(15),n(14),n(13),n(12),n(11),n(4),n(10),n(9),n(8),e.exports=r}])});
//# sourceMappingURL=ething.js.map